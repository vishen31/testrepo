define(["librastandardlib/dom-utils/trapFocus","librastandardlib/event-utils/event-keys"],function(trapFocus,eventKeys){"use strict";var defaults={lockClass:"lb-modal-lock",activeClass:"lb-active",modalContentSelector:".lb-modal-content",closeButtonSelector:".lb-modal-close"};function bindOpenHandler(){var that=this;this.$triggers.each(function(){this.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();that.activateModal(e)},true);if(!$(this).is("a, button")){this.addEventListener("keypress",function(e){if(e.key===eventKeys.ENTER||e.key===eventKeys.SPACE){e.preventDefault();e.stopPropagation();that.activateModal(e)}},true)}})}function bindCloseHandler(){var escapeHandler=function(e){if(e.keyCode===27){this.deactivateModal()}}.bind(this);$(document).on("keyup.lb_modal_key-close",escapeHandler);this.$elem.find(this.options.closeButtonSelector).click(function(){this.deactivateModal()}.bind(this));var handler=function(e){var event=e.target||e.srcElement;var target=$(event);if(target.is(this.$elem)){this.deactivateModal()}}.bind(this);$(document).on("click.lb_modal_close",handler)}var ModalMixin={initModal:function(){this.options=$.extend({},defaults,this.$elem.data());this.modalId=this.$elem.data("lbModalId");this.$triggers=$('[data-lb-modal-trigger="'+this.modalId+'"]');bindOpenHandler.call(this);this.$elem.trigger("custom_lb-modal_after-init")},activateModal:function(event){$("body").addClass(this.options.lockClass);this.$elem.addClass(this.options.activeClass);bindCloseHandler.call(this);this.$elem.trigger("custom_lb-modal_after-open");this.$triggers.attr("aria-expanded",true);this.$triggerElem=event.target;this.$elem.children(this.options.modalContentSelector).attr("tabindex","0");trapFocus(this.$elem.children(this.options.modalContentSelector))},deactivateModal:function(){this.$elem.trigger("custom_lb_comp-content-container_close");this.$elem.removeClass(this.options.activeClass);$("body").removeClass(this.options.lockClass);this.$elem.children(this.options.modalContentSelector).removeAttr("tabindex");this.$triggers.attr("aria-expanded",false);$(document).off("click.lb_modal_close");$(document).off("keyup.lb_modal_key-close");this.$triggerElem.focus()}};return ModalMixin});